{"version":3,"file":"static/js/index.1b3fef1.js","sources":["webpack:///./src/lib/utils/bridge.js"],"sourcesContent":["/* eslint-disable */\n(function () {\n  if (window.bridge) {\n    return;\n  }\n\n  window.bridge = {};\n\n  var messages = {};\n  var call_id = 0;\n\n  // 注册handler，native调用\n  window.bridge.register = function (name) {\n    if (this[name]) {\n      return;\n    }\n\n    // 设置handler为bridge的属性方法\n    this[name] = function (params, callback) {\n      invokeNative(name, params, callback);\n    };\n  };\n\n  // 根据call_id获取参数，native调用\n  window.bridge.obtain = function (id) {\n    return JSON.stringify(messages[id].params);\n  };\n\n  // 根据call_id和回调数据执行JS的回调函数，native调用\n  window.bridge.callback = function (id, data) {\n    var message = messages[id];\n    if (!message) {\n      return;\n    }\n\n    if (message.callback) {\n      message.callback(JSON.parse(data));\n    }\n\n    delete messages[id]; // 删除参数和回调函数\n  };\n\n  // 给native发送消息\n  function invokeNative(name, params, callback) {\n    call_id++; // call_id递增\n    messages[call_id] = {\n      params: params,\n      callback: callback\n    }; // 保存参数和回调函数\n\n    if (navigator.userAgent.indexOf('Android') > -1 || navigator.userAgent.indexOf('Adr') > -1) {\n      // Android\n      window.prompt(JSON.stringify({\n        cmd: name,\n        id: call_id,\n        params: params\n      }), '');\n    } else {\n      // iOS\n      // 方式1：\n      var iframe = document.createElement('iframe');\n      iframe.src = 'bridge://invoke.native.method?handler=' + name + '&id=' + call_id;\n      iframe.style.display = 'none';\n      document.documentElement.appendChild(iframe);\n      setTimeout(function () {\n        document.documentElement.removeChild(iframe);\n      }, 0);\n\n      // 方式2：\n      // try{\n      //     var msg = JSON.stringify({id : call_id, params : params});\n      //     eval('window.webkit.messageHandlers.' + name + '.postMessage(' + msg + ')');\n      // } catch (error) {\n      //     console.log(error)\n      // }\n\n      // 方式3：\n      // window.prompt(JSON.stringify({cmd : name, id : call_id, params : params}), '');\n    }\n  }\n})();\n/* eslint-disable */\n"],"mappings":"AACA","sourceRoot":""}